version: 0.2
env:
  parameter-store:
    db_user: db_user
    db_pwd: db_password

phases:
  install:
    runtime-versions:
      python: 3.7

  pre_build:
    commands:
      - echo "Pull down flyway tool"
      - wget -qO- https://repo1.maven.org/maven2/org/flywaydb/flyway-commandline/7.8.1/flyway-commandline-7.8.1-linux-x64.tar.gz | tar xvz

  build:
    commands:
      - echo "Build something ... "

  post_build:
    commands:
      - echo "CURRENT MIGRATION STATUS"
      - ./flyway-7.8.1/flyway -configFiles="sql/flyway_configurations/TEST_DB.conf" info  -user=$db_user -password=$db_pwd
      - echo "PERFORM SQL MIGRATIONS"
      - ./flyway-7.8.1/flyway -configFiles="sql/flyway_configurations/TEST_DB.conf" migrate  -user=$db_user -password=$db_pwd


